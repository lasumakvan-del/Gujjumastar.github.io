<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=2.0, user-scalable=yes, viewport-fit=cover">
    <title>Word Family Flashcard - Makvana Sanjaysir</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        /* ===== FIXED BOX SIZE ‚Äî SAME IN ALL MODES ===== */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #6a11cb, #2575fc);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 8px;
        }

        .container {
            width: 100%;
            max-width: 700px;
            background: rgba(255,255,255,0.95);
            border-radius: 28px;
            padding: 20px 16px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.25);
            text-align: center;
        }

        h1 {
            color: #2575fc;
            font-size: clamp(1.6rem, 6vw, 2.2rem);
            margin-bottom: 4px;
            letter-spacing: -0.5px;
        }

        .subtitle {
            color: #6a11cb;
            font-size: 0.95rem;
            margin-bottom: 16px;
            font-weight: 500;
        }

        /* ----- FAMILY BUTTONS ----- */
        .family-selector {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 8px;
            margin-bottom: 16px;
        }

        .family-btn {
            background: #e9ecf5;
            border: 2px solid #ddd;
            border-radius: 40px;
            padding: 6px 16px;
            font-size: 13px;
            font-weight: 700;
            color: #1e3a5f;
            cursor: pointer;
            transition: 0.2s;
            box-shadow: 0 3px 0 #b0bec5;
        }

        .family-btn.active {
            background: #5e35b1;
            color: white;
            border-color: white;
            box-shadow: 0 5px 0 #311b92;
            transform: translateY(-2px);
        }

        /* ----- FLASHCARD ----- */
        .flashcard {
            width: 100%;
            max-width: 520px;
            background: linear-gradient(145deg, #36d1dc, #5b86e5);
            border-radius: 28px;
            padding: 16px 14px;
            margin: 0 auto;
            box-shadow: 0 12px 0 #1a237e, 0 18px 30px rgba(0,0,0,0.3);
            cursor: pointer;
            position: relative;
        }

        .flashcard:active { transform: scale(0.98); }

        .spiral-holes {
            position: absolute;
            top: -10px;
            left: 0;
            right: 0;
            height: 22px;
            background: repeating-linear-gradient(90deg,
                transparent 0px,
                transparent 22px,
                rgba(255,255,255,0.9) 22px,
                rgba(255,255,255,0.9) 32px);
            border-radius: 28px 28px 0 0;
            z-index: 2;
        }

        /* ----- HEADER ----- */
        .card-header {
            background: white;
            border-radius: 20px;
            padding: 8px 16px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 14px;
            box-shadow: 0 5px 0 #b0bec5;
        }

        .header-icon-container {
            position: relative;
            width: 48px;
            height: 48px;
            perspective: 300px;
        }

        .header-icon {
            position: absolute;
            width: 100%;
            height: 100%;
            background: #ffb74d;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 30px;
            backface-visibility: hidden;
            transition: transform 0.6s;
            box-shadow: inset 0 -3px 0 #e67e22;
        }

        .header-icon.flipped { transform: rotateY(180deg); }

        .header-icon + .header-icon {
            background: #4fc3f7;
            transform: rotateY(180deg);
        }

        /* ----- SPEAK TOGGLE BUTTON ----- */
        .sound-toggle-btn {
            background: #1e88e5;
            border: none;
            border-radius: 50%;
            width: 44px;
            height: 44px;
            color: white;
            font-size: 1.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 6px 0 #0d47a1;
            cursor: pointer;
            transition: 0.07s;
        }

        .sound-toggle-btn:active { transform: translateY(6px); box-shadow: 0 1px 0 #0d47a1; }
        .sound-toggle-btn.off { background: #757575; box-shadow: 0 6px 0 #424242; }

        /* ----- MAIN WORD AREA ----- */
        .card-main {
            background: white;
            border-radius: 22px;
            padding: 16px 12px;
            box-shadow: inset 0 4px 10px rgba(0,0,0,0.05);
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        /* ‚≠ê‚≠ê‚≠ê FLEX NOWRAP ‚Äî NEVER GO TO NEXT LINE ‚≠ê‚≠ê‚≠ê */
        .main-word {
            display: flex;
            flex-wrap: nowrap !important;
            align-items: center;
            justify-content: center;
            gap: 6px;
            margin-bottom: 16px;
            width: 100%;
        }

        /* ‚≠ê‚≠ê‚≠ê FIXED BOX SIZE ‚Äî SAME IN ALL MODES ‚≠ê‚≠ê‚≠ê */
        .main-letter-container {
            position: relative;
            width: auto;
            min-width: 60px;
            max-width: 180px;   /* 6 ‡™Ö‡™ï‡´ç‡™∑‡™∞‡´ã ‡™∏‡´Å‡™ß‡´Ä ‡™´‡´Ä‡™ü */
            height: 70px;        /* height fixed */
            perspective: 600px;
            flex-shrink: 1;
            display: flex;
            justify-content: center;
        }

        .main-letter {
            position: absolute;
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 900;
            color: #c62828;
            background: linear-gradient(145deg, #ffcdd2, #ffebee);
            border-radius: 18px;
            box-shadow: 0 8px 0 #b71c1c;
            backface-visibility: hidden;
            transition: transform 0.6s;
            white-space: nowrap;
            padding: 0 8px;
            line-height: 1;
            /* font-size will be adjusted in media queries */
            font-size: 42px;
        }

        .main-letter.flipped { transform: rotateY(180deg); }

        .main-ending {
            font-weight: 900;
            color: #006064;
            text-shadow: 3px 3px 0 #b2ebf2;
            white-space: nowrap;
            line-height: 1;
            font-size: 42px;
            flex-shrink: 0;
        }

        /* ----- GUJARATI MEANING DISPLAY ----- */
        .gujarati-box {
            background: #ede7f6;
            padding: 12px 24px;
            border-radius: 60px;
            font-size: 1.6rem;
            font-weight: 800;
            color: #4527a0;
            box-shadow: inset 0 -5px 0 #9575cd, 0 6px 0 #5e35b1;
            text-align: center;
            display: inline-block;
            margin-top: 4px;
            border: 1px solid white;
            letter-spacing: 1px;
            width: fit-content;
            max-width: 100%;
            word-break: break-word;
        }

        .click-hint {
            position: absolute;
            bottom: 10px;
            right: 16px;
            background: rgba(0,0,0,0.6);
            color: white;
            padding: 5px 16px;
            border-radius: 50px;
            font-size: 0.75rem;
            font-weight: 700;
            backdrop-filter: blur(4px);
            border: 1px solid rgba(255,255,255,0.4);
        }

        .page-flip-sound {
            opacity: 0;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 26px;
            color: white;
            pointer-events: none;
            animation: flipSound 0.6s ease-out;
        }

        @keyframes flipSound {
            0% { opacity: 1; transform: translate(-50%, -50%) scale(0.5); }
            50% { opacity: 0.8; transform: translate(-50%, -50%) scale(1.2); }
            100% { opacity: 0; transform: translate(-50%, -50%) scale(1); }
        }

        /* ----- CONTROLS ----- */
        .controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 500px;
            margin: 18px auto 12px;
        }

        .nav-btn {
            background: #5B86E5;
            color: white;
            border: none;
            border-radius: 50%;
            width: 52px;
            height: 52px;
            font-size: 1.6rem;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 8px 0 #1e3a8a;
            cursor: pointer;
            transition: 0.07s;
        }

        .nav-btn:active { transform: translateY(8px); box-shadow: 0 1px 0 #1e3a8a; }
        .nav-btn:disabled { opacity: 0.5; transform: translateY(4px); box-shadow: 0 4px 0 #999; }

        .control-center {
            display: flex;
            gap: 10px;
        }

        .shuffle-btn, .auto-play-btn, .quiz-btn {
            background: #FF9F7C;
            color: white;
            border: none;
            border-radius: 40px;
            padding: 8px 18px;
            font-size: 14px;
            font-weight: 700;
            box-shadow: 0 6px 0 #e67e22;
            display: flex;
            align-items: center;
            gap: 6px;
            cursor: pointer;
        }

        .shuffle-btn:active, .auto-play-btn:active, .quiz-btn:active { transform: translateY(6px); box-shadow: 0 1px 0 #e67e22; }
        .auto-play-btn.active, .quiz-btn.active { background: #4CAF50; box-shadow: 0 6px 0 #2e7d32; }

        .progress {
            font-weight: 700;
            color: #1e3a8a;
            margin: 10px 0 6px;
            font-size: 1rem;
        }

        .progress-bar {
            max-width: 450px;
            height: 8px;
            background: #f0f0f0;
            border-radius: 4px;
            margin: 8px auto;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #36D1DC, #5B86E5);
            width: 0%;
            transition: width 0.3s;
        }

        .score-display {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin: 10px 0;
            font-size: 14px;
            font-weight: 700;
            color: #6a11cb;
        }

        .score-item {
            background: #f0f0f0;
            padding: 6px 20px;
            border-radius: 40px;
        }

        .school-footer {
            background: #ffb300;
            color: #0d2c54;
            padding: 12px 18px;
            border-radius: 60px;
            font-weight: 900;
            font-size: 1.1rem;
            margin-top: 18px;
            box-shadow: 0 8px 0 #b26500;
            border: 1px solid white;
        }

        .voice-selector {
            display: flex;
            justify-content: center;
            gap: 8px;
            margin: 12px 0;
        }

        .voice-select {
            background: white;
            border: 2px solid #ddd;
            border-radius: 40px;
            padding: 6px 16px;
            font-size: 13px;
            font-weight: 500;
        }

        .tts-error {
            display: none;
            background: #ffebee;
            color: #d32f2f;
            padding: 8px 16px;
            border-radius: 40px;
            margin-top: 8px;
            font-size: 12px;
            font-weight: 600;
        }

        .quiz-container {
            display: none;
            background: #f0f0f0;
            border-radius: 24px;
            padding: 20px;
            margin-top: 20px;
        }

        .quiz-question {
            font-size: 1.2rem;
            font-weight: 800;
            margin-bottom: 16px;
            color: #4527a0;
        }

        .quiz-options {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin: 16px 0;
        }

        .quiz-option {
            background: white;
            border: 2px solid #ddd;
            border-radius: 16px;
            padding: 12px 8px;
            font-weight: 700;
            cursor: pointer;
            transition: 0.2s;
        }

        .quiz-option.correct { background: #4CAF50; color: white; border-color: #2e7d32; }
        .quiz-option.incorrect { background: #f44336; color: white; border-color: #b71c1c; }

        .keyboard-shortcuts {
            background: rgba(0,0,0,0.2);
            border-radius: 30px;
            padding: 10px;
            margin-top: 16px;
            font-size: 0.75rem;
            color: white;
            text-align: center;
            backdrop-filter: blur(4px);
        }

        /* ===== RESPONSIVE FONT SIZES ‚Äî BOX SIZE REMAINS SAME ===== */
        @media (max-width: 550px) {
            .main-letter { font-size: 36px; }
            .main-ending { font-size: 36px; }
            .gujarati-box { font-size: 1.4rem; padding: 10px 20px; }
        }

        @media (max-width: 400px) {
            .main-letter { font-size: 32px; }
            .main-ending { font-size: 32px; }
            .gujarati-box { font-size: 1.2rem; padding: 8px 16px; }
        }

        @media (orientation: landscape) and (max-height: 500px) {
            /* Box size unchanged, only font size reduced */
            .main-letter { font-size: 32px; }
            .main-ending { font-size: 32px; }
            .gujarati-box { font-size: 1.3rem; padding: 6px 16px; }
        }

        @media (min-width: 601px) and (max-width: 1024px) {
            .main-letter { font-size: 44px; }
            .main-ending { font-size: 44px; }
            .gujarati-box { font-size: 1.9rem; }
        }

        /* Large screens */
        @media (min-width: 1025px) {
            .main-letter { font-size: 46px; }
            .main-ending { font-size: 46px; }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üì¨ Word Family</h1>
        <div class="subtitle">ice ¬∑ ight ¬∑ ick ¬∑ ing | Gujarati Meaning</div>

        <!-- Family Buttons -->
        <div class="family-selector">
            <button class="family-btn active" data-family="ice">-ice</button>
            <button class="family-btn" data-family="ight">-ight</button>
            <button class="family-btn" data-family="ick">-ick</button>
            <button class="family-btn" data-family="ing">-ing</button>
        </div>

        <!-- Voice & Quiz -->
        <div style="display: flex; justify-content: center; gap: 12px; flex-wrap: wrap; margin-bottom: 16px;">
            <button class="quiz-btn" id="quiz-btn"><i class="fas fa-question-circle"></i> Quiz</button>
            <div class="voice-selector">
                <select class="voice-select" id="voice-select">
                    <option value="sweet">üé≠ ‡™Æ‡´Ä‡™†‡´ã ‡™Ö‡™µ‡™æ‡™ú</option>
                    <option value="clear">üó£Ô∏è ‡™∏‡´ç‡™™‡™∑‡´ç‡™ü ‡™Ö‡™µ‡™æ‡™ú</option>
                    <option value="auto" selected>ü§ñ ‡™ì‡™ü‡´ã</option>
                </select>
            </div>
        </div>

        <!-- ========== FLASHCARD ========== -->
        <div class="flashcard" id="flashcard">
            <div class="spiral-holes"></div>

            <!-- Card Header ‚Äî Only Icon & Speaker -->
            <div class="card-header">
                <div class="header-icon-container">
                    <div class="header-icon" id="header-icon-current">üé≤</div>
                    <div class="header-icon flipped" id="header-icon-next">üê≠</div>
                </div>
                <button class="sound-toggle-btn" id="speakToggleBtn">
                    <i class="fas fa-volume-up" id="speakIcon"></i>
                </button>
            </div>

            <!-- Main Content -->
            <div class="card-main">
                <div class="main-word">
                    <div class="main-letter-container">
                        <div class="main-letter" id="main-current">D</div>
                        <div class="main-letter flipped" id="main-next">M</div>
                    </div>
                    <span class="main-ending" id="word-ending">ice</span>
                </div>

                <!-- Gujarati Meaning -->
                <div class="gujarati-box" id="gujarati-meaning">
                    ‡™™‡™æ‡™∂‡´ã
                </div>
            </div>

            <div class="click-hint">üëá Click to flip</div>
            <div class="page-flip-sound" id="flip-indicator">üìñ</div>
        </div>

        <!-- TTS Error -->
        <div class="tts-error" id="tts-error">
            ‚ö†Ô∏è Speech not supported. Use Chrome/Edge.
        </div>

        <!-- Controls -->
        <div class="controls">
            <button class="nav-btn" id="prev-btn" disabled>
                <i class="fas fa-arrow-left"></i>
            </button>
            <div class="control-center">
                <button class="shuffle-btn" id="shuffle-btn">
                    <i class="fas fa-random"></i> Shuffle
                </button>
                <button class="auto-play-btn" id="auto-play-btn">
                    <i class="fas fa-play"></i> Auto
                </button>
            </div>
            <button class="nav-btn" id="next-btn">
                <i class="fas fa-arrow-right"></i>
            </button>
        </div>

        <!-- Progress -->
        <div class="progress">
            <div class="progress-bar">
                <div class="progress-fill" id="progress-fill"></div>
            </div>
            <span id="current-index">1</span>/<span id="total-words">14</span> words
        </div>

        <!-- Stats -->
        <div class="score-display">
            <span class="score-item"><i class="fas fa-eye"></i> Viewed: <span id="viewed-count">0</span></span>
            <span class="score-item"><i class="fas fa-volume-up"></i> Pronounced: <span id="pronounced-count">0</span></span>
        </div>

        <!-- Quiz Container -->
        <div class="quiz-container" id="quiz-container">
            <div class="quiz-question" id="quiz-question"></div>
            <div class="quiz-options" id="quiz-options"></div>
            <div class="quiz-result" id="quiz-result"></div>
            <div class="quiz-score" id="quiz-score">Score: 0/0</div>
            <button class="nav-btn" id="next-question-btn" style="margin: 16px auto; display: block;">Next</button>
        </div>

        <!-- School Footer -->
        <div class="school-footer">
            üè´ Makvana Sanjaysir ¬∑ Piparadi-2 Primary School
        </div>

        <!-- Shortcuts -->
        <div class="keyboard-shortcuts">
            <strong>Shortcuts:</strong> Space/‚Üí (flip), ‚Üê (prev), ‚Üë (next), Enter (speak), S (shuffle), A (auto), Q (quiz)
        </div>
    </div>

    <script>
        (function() {
            "use strict";

            // ---------- üìö WORD DATABASE ----------
            const wordFamilies = {
                ice: [
                    { letter: 'D', icon: 'üé≤', gujarati: '‡™™‡™æ‡™∂‡´ã' },
                    { letter: 'M', icon: 'üê≠', gujarati: '‡™â‡™Ç‡™¶‡™∞' },
                    { letter: 'N', icon: 'üëç', gujarati: '‡™∏‡™æ‡™∞‡´Å‡™Ç' },
                    { letter: 'Pr', icon: 'üí∞', gujarati: '‡™ï‡™ø‡™Ç‡™Æ‡™§' },
                    { letter: 'R', icon: 'üçö', gujarati: '‡™ö‡´ã‡™ñ‡™æ' },
                    { letter: 'Sl', icon: 'üî™', gujarati: '‡™ï‡™ü‡™ï‡´ã' },
                    { letter: 'Tw', icon: '2Ô∏è‚É£', gujarati: '‡™¨‡´á ‡™µ‡™ñ‡™§' },
                    { letter: 'Sp', icon: 'üå∂Ô∏è', gujarati: '‡™Æ‡™∏‡™æ‡™≤‡´ã' },
                    { letter: 'Adv', icon: 'üí°', gujarati: '‡™∏‡™≤‡™æ‡™π' },
                    { letter: 'Pract', icon: 'üìö', gujarati: '‡™Ö‡™≠‡´ç‡™Ø‡™æ‡™∏' },
                    { letter: 'Dev', icon: 'üì±', gujarati: '‡™∏‡™æ‡™ß‡™®' },
                    { letter: 'Serv', icon: 'üõéÔ∏è', gujarati: '‡™∏‡´á‡™µ‡™æ' },
                    { letter: 'Off', icon: 'üè¢', gujarati: '‡™ï‡™ö‡´á‡™∞‡´Ä' },
                    { letter: 'Pol', icon: 'üëÆ', gujarati: '‡™™‡´ã‡™≤‡´Ä‡™∏' }
                ],
                ight: [
                    { letter: 'B', icon: 'üí°', gujarati: '‡™â‡™ú‡™æ‡™∏' },
                    { letter: 'F', icon: 'üëä', gujarati: '‡™≤‡™°‡™µ‡´Å‡™Ç' },
                    { letter: 'L', icon: 'üïØÔ∏è', gujarati: '‡™™‡´ç‡™∞‡™ï‡™æ‡™∂' },
                    { letter: 'N', icon: 'üåô', gujarati: '‡™∞‡™æ‡™§' },
                    { letter: 'R', icon: 'üëâ', gujarati: '‡™ú‡™Æ‡™£‡´Å‡™Ç' },
                    { letter: 'S', icon: 'üëÅÔ∏è', gujarati: '‡™¶‡´É‡™∂‡´ç‡™Ø' },
                    { letter: 'T', icon: 'üîí', gujarati: '‡™ï‡™∏‡™µ‡´Å‡™Ç' }
                ],
                ick: [
                    { letter: 'S', icon: 'ü§í', gujarati: '‡™¨‡´Ä‡™Æ‡™æ‡™∞' },
                    { letter: 'P', icon: 'üëÜ', gujarati: '‡™™‡™∏‡™Ç‡™¶ ‡™ï‡™∞‡™µ‡´Å‡™Ç' },
                    { letter: 'T', icon: '‚úÖ', gujarati: '‡™ü‡™ø‡™ï' },
                    { letter: 'K', icon: 'ü¶µ', gujarati: '‡™≤‡™æ‡™§ ‡™Æ‡™æ‡™∞‡™µ‡´Ä' },
                    { letter: 'L', icon: 'üëÖ', gujarati: '‡™ö‡™æ‡™ü‡™µ‡´Å‡™Ç' },
                    { letter: 'St', icon: 'ü™µ', gujarati: '‡™≤‡™æ‡™ï‡™°‡´Ä' },
                    { letter: 'Br', icon: 'üß±', gujarati: '‡™à‡™Ç‡™ü' },
                    { letter: 'Ch', icon: 'üê£', gujarati: '‡™ö‡´Ç‡™ù‡´ã' },
                    { letter: 'Qu', icon: '‚ö°', gujarati: '‡™ù‡™°‡™™‡™•‡´Ä' },
                    { letter: 'Tr', icon: 'ü™Ñ', gujarati: '‡™ï‡™™‡™ü' },
                    { letter: 'Th', icon: 'üìè', gujarati: '‡™ú‡™æ‡™°‡´Å‡™Ç' },
                    { letter: 'N', icon: '‚úÇÔ∏è', gujarati: '‡™®‡™æ‡™®‡´ã ‡™ï‡™™' },
                    { letter: 'Fl', icon: 'üí´', gujarati: '‡™ù‡™°‡™™‡´Ä ‡™π‡™≤‡™æ‡™µ‡™µ‡´Å‡™Ç' },
                    { letter: 'Cl', icon: 'üñ±Ô∏è', gujarati: '‡™ï‡´ç‡™≤‡™ø‡™ï ‡™ï‡™∞‡™µ‡´Å‡™Ç' },
                    { letter: 'Mus', icon: 'üéµ', gujarati: '‡™∏‡™Ç‡™ó‡´Ä‡™§' }
                ],
                ing: [
                    { letter: 'K', icon: 'üëë', gujarati: '‡™∞‡™æ‡™ú‡™æ' },
                    { letter: 'R', icon: 'üíç', gujarati: '‡™ä‡™Ç‡™ó‡™≥‡´Ä‡™®‡´Ä ‡™µ‡´á‡™¢‡´Ä' },
                    { letter: 'S', icon: 'üé§', gujarati: '‡™ó‡™æ‡™µ‡´Å‡™Ç' },
                    { letter: 'W', icon: 'üïäÔ∏è', gujarati: '‡™™‡™æ‡™Ç‡™ñ' },
                    { letter: 'Br', icon: 'üéÅ', gujarati: '‡™≤‡™æ‡™µ‡™µ‡´Å‡™Ç' },
                    { letter: 'Sw', icon: 'üé™', gujarati: '‡™ù‡´Ç‡™≤‡™µ‡´Å‡™Ç' },
                    { letter: 'Th', icon: 'üì¶', gujarati: '‡™µ‡™∏‡´ç‡™§‡´Å' },
                    { letter: 'Str', icon: 'üßµ', gujarati: '‡™¶‡´ã‡™∞‡´Ä' },
                    { letter: 'Spr', icon: 'üå∏', gujarati: '‡™µ‡™∏‡™Ç‡™§' },
                    { letter: 'Cl', icon: 'ü§ó', gujarati: '‡™ö‡´ã‡™Ç‡™ü‡™µ‡´Å‡™Ç' },
                    { letter: 'St', icon: 'üêù', gujarati: '‡™°‡™Ç‡™ñ ‡™Æ‡™æ‡™∞‡™µ‡´ã' },
                    { letter: 'Fl', icon: 'üéØ', gujarati: '‡™â‡™õ‡™æ‡™≥‡™µ‡´Å‡™Ç' },
                    { letter: 'Sl', icon: 'üéí', gujarati: '‡™™‡™ü‡´ç‡™ü‡´ã' },
                    { letter: 'Morn', icon: 'üåÖ', gujarati: '‡™∏‡™µ‡™æ‡™∞‡´á' },
                    { letter: 'Even', icon: 'üåÜ', gujarati: '‡™∏‡™æ‡™Ç‡™ú‡´á' }
                ]
            };

            // ---------- STATE ----------
            let currentFamily = 'ice';
            let currentIdx = 0;
            let isFlipping = false;
            let viewedCount = 0, pronouncedCount = 0;
            let autoPlayInterval = null, isAutoPlaying = false;
            let isQuizMode = false, quizScore = 0, quizTotal = 0, currentQuiz = null;
            let autoSpeakEnabled = true;

            // ---------- DOM ELEMENTS ----------
            const flashcard = document.getElementById('flashcard');
            const iconFront = document.getElementById('header-icon-current');
            const iconBack = document.getElementById('header-icon-next');
            const letterFront = document.getElementById('main-current');
            const letterBack = document.getElementById('main-next');
            const wordEnding = document.getElementById('word-ending');
            const gujaratiMeaning = document.getElementById('gujarati-meaning');
            const speakBtn = document.getElementById('speakToggleBtn');
            const speakIcon = document.getElementById('speakIcon');
            const prevBtn = document.getElementById('prev-btn');
            const nextBtn = document.getElementById('next-btn');
            const shuffleBtn = document.getElementById('shuffle-btn');
            const autoPlayBtn = document.getElementById('auto-play-btn');
            const currentSpan = document.getElementById('current-index');
            const totalSpan = document.getElementById('total-words');
            const progressFill = document.getElementById('progress-fill');
            const viewedSpan = document.getElementById('viewed-count');
            const pronouncedSpan = document.getElementById('pronounced-count');
            const ttsError = document.getElementById('tts-error');
            const familyBtns = document.querySelectorAll('.family-btn');
            const voiceSelect = document.getElementById('voice-select');
            const quizBtn = document.getElementById('quiz-btn');
            const flashcardSection = document.getElementById('flashcard-section') || { style: {} };
            const quizContainer = document.getElementById('quiz-container');
            const quizQuestion = document.getElementById('quiz-question');
            const quizOptions = document.getElementById('quiz-options');
            const quizResult = document.getElementById('quiz-result');
            const quizScoreDisp = document.getElementById('quiz-score');
            const nextQBtn = document.getElementById('next-question-btn');

            // ---------- HELPER FUNCTIONS ----------
            const getCurrent = () => wordFamilies[currentFamily][currentIdx];
            const getNext = () => wordFamilies[currentFamily][(currentIdx + 1) % wordFamilies[currentFamily].length];

            function resetFlip() {
                iconFront.classList.remove('flipped');
                iconBack.classList.add('flipped');
                letterFront.classList.remove('flipped');
                letterBack.classList.add('flipped');
            }

            function toggleSpeak() {
                autoSpeakEnabled = !autoSpeakEnabled;
                if (autoSpeakEnabled) {
                    speakBtn.classList.remove('off');
                    speakIcon.className = 'fas fa-volume-up';
                    speakBtn.style.background = '#1e88e5';
                } else {
                    speakBtn.classList.add('off');
                    speakIcon.className = 'fas fa-volume-mute';
                    speakBtn.style.background = '#757575';
                }
            }

            function speakText(text) {
                if (!window.speechSynthesis) return showTTSError();
                try {
                    window.speechSynthesis.cancel();
                    const utterance = new SpeechSynthesisUtterance(text);
                    const voices = speechSynthesis.getVoices();
                    const pref = voiceSelect.value;
                    let selected = null;
                    if (pref === 'sweet') {
                        ['Google UK English Female','Microsoft Zira','Samantha','Victoria'].some(v => selected = voices.find(vc => vc.name.includes(v)));
                        utterance.rate = 0.8; utterance.pitch = 1.2;
                    } else if (pref === 'clear') {
                        ['Microsoft Zira','Google UK English Female','Samantha'].some(v => selected = voices.find(vc => vc.name.includes(v)));
                        utterance.rate = 0.9; utterance.pitch = 1.0;
                    } else {
                        ['Google UK English Female','Microsoft Zira','Samantha'].some(v => selected = voices.find(vc => vc.name.includes(v)));
                        utterance.rate = 0.85; utterance.pitch = 1.1;
                    }
                    if (!selected) selected = voices.find(v => v.lang.includes('en'));
                    if (selected) utterance.voice = selected;
                    utterance.lang = 'en-US';
                    utterance.onerror = showTTSError;
                    window.speechSynthesis.speak(utterance);
                    ttsError.style.display = 'none';
                } catch { showTTSError(); }
            }

            function speakCurrent() {
                const w = getCurrent();
                speakText(w.letter.toLowerCase() + currentFamily);
                pronouncedCount++; updateStats();
            }

            function showTTSError() {
                ttsError.style.display = 'block';
                setTimeout(() => ttsError.style.display = 'none', 2500);
            }

            function updateCard() {
                const cur = getCurrent(), nxt = getNext();
                iconFront.textContent = cur.icon;
                iconBack.textContent = nxt.icon;
                letterFront.textContent = cur.letter;
                letterBack.textContent = nxt.letter;
                wordEnding.textContent = currentFamily;
                gujaratiMeaning.textContent = cur.gujarati;
            }

            function updateProgress() {
                currentSpan.textContent = currentIdx + 1;
                totalSpan.textContent = wordFamilies[currentFamily].length;
                progressFill.style.width = ((currentIdx + 1) / wordFamilies[currentFamily].length * 100) + '%';
            }

            function updateNav() {
                prevBtn.disabled = currentIdx === 0;
                nextBtn.disabled = currentIdx === wordFamilies[currentFamily].length - 1;
            }

            function updateStats() {
                viewedSpan.textContent = viewedCount;
                pronouncedSpan.textContent = pronouncedCount;
            }

            // ---------- ACTIONS ----------
            function flipCard() {
                if (isFlipping) return;
                if (currentIdx >= wordFamilies[currentFamily].length - 1) {
                    flashcard.style.transform = 'translateX(4px)';
                    setTimeout(() => flashcard.style.transform = '', 100);
                    return;
                }
                isFlipping = true;
                viewedCount++;
                iconFront.classList.add('flipped');
                iconBack.classList.remove('flipped');
                letterFront.classList.add('flipped');
                letterBack.classList.remove('flipped');
                setTimeout(() => {
                    currentIdx++;
                    iconFront.classList.remove('flipped');
                    iconBack.classList.add('flipped');
                    letterFront.classList.remove('flipped');
                    letterBack.classList.add('flipped');
                    updateCard(); updateProgress(); updateNav(); updateStats();
                    if (autoSpeakEnabled) speakCurrent();
                    isFlipping = false;
                }, 300);
            }

            function nextWord() { if (!isFlipping && currentIdx < wordFamilies[currentFamily].length - 1) { currentIdx++; resetFlip(); updateCard(); updateProgress(); updateNav(); if (autoSpeakEnabled) speakCurrent(); } }
            function prevWord() { if (!isFlipping && currentIdx > 0) { currentIdx--; resetFlip(); updateCard(); updateProgress(); updateNav(); if (autoSpeakEnabled) speakCurrent(); } }

            function switchFamily(family) {
                if (currentFamily === family) return;
                currentFamily = family; currentIdx = 0;
                familyBtns.forEach(b => b.classList.toggle('active', b.dataset.family === family));
                resetFlip(); updateCard(); updateProgress(); updateNav();
                if (autoSpeakEnabled) speakCurrent();
                if (isQuizMode) generateQuiz();
            }

            function shuffleWords() {
                const arr = wordFamilies[currentFamily];
                for (let i = arr.length - 1; i > 0; i--) { const j = Math.floor(Math.random() * (i + 1)); [arr[i], arr[j]] = [arr[j], arr[i]]; }
                currentIdx = 0; resetFlip(); updateCard(); updateProgress(); updateNav();
                if (autoSpeakEnabled) speakCurrent();
            }

            function toggleAutoPlay() {
                if (isAutoPlaying) {
                    clearInterval(autoPlayInterval);
                    autoPlayBtn.innerHTML = '<i class="fas fa-play"></i> Auto';
                    autoPlayBtn.classList.remove('active');
                    isAutoPlaying = false;
                } else {
                    autoPlayInterval = setInterval(flipCard, 3000);
                    autoPlayBtn.innerHTML = '<i class="fas fa-pause"></i> Auto';
                    autoPlayBtn.classList.add('active');
                    isAutoPlaying = true;
                }
            }

            // ---------- QUIZ ----------
            function toggleQuizMode() {
                isQuizMode = !isQuizMode;
                if (isQuizMode) {
                    quizBtn.innerHTML = '<i class="fas fa-times"></i> Exit Quiz';
                    quizBtn.classList.add('active');
                    flashcardSection.style.display = 'none';
                    quizContainer.style.display = 'block';
                    generateQuiz();
                } else {
                    quizBtn.innerHTML = '<i class="fas fa-question-circle"></i> Quiz';
                    quizBtn.classList.remove('active');
                    flashcardSection.style.display = 'block';
                    quizContainer.style.display = 'none';
                    quizScore = 0; quizTotal = 0; quizScoreDisp.textContent = 'Score: 0/0';
                }
            }

            function generateQuiz() {
                const words = wordFamilies[currentFamily];
                const correctIdx = Math.floor(Math.random() * words.length);
                const correct = words[correctIdx];
                const wrong = [];
                while (wrong.length < 3) {
                    const r = Math.floor(Math.random() * words.length);
                    if (r !== correctIdx && !wrong.includes(words[r].gujarati)) wrong.push(words[r].gujarati);
                }
                let opts = [correct.gujarati, ...wrong];
                for (let i = opts.length - 1; i > 0; i--) { const j = Math.floor(Math.random() * (i + 1)); [opts[i], opts[j]] = [opts[j], opts[i]]; }
                currentQuiz = { word: correct.letter + currentFamily, answer: correct.gujarati, options: opts };
                quizQuestion.textContent = `Gujarati meaning of "${correct.letter + currentFamily}"?`;
                quizOptions.innerHTML = '';
                opts.forEach(o => {
                    const el = document.createElement('div');
                    el.className = 'quiz-option';
                    el.textContent = o;
                    el.onclick = () => {
                        quizTotal++;
                        document.querySelectorAll('.quiz-option').forEach(opt => opt.style.pointerEvents = 'none');
                        if (o === currentQuiz.answer) { quizScore++; quizResult.textContent = '‚úÖ Correct!'; quizResult.style.color = '#4CAF50'; }
                        else { quizResult.textContent = `‚ùå Incorrect. Answer: ${currentQuiz.answer}`; quizResult.style.color = '#f44336'; }
                        quizScoreDisp.textContent = `Score: ${quizScore}/${quizTotal}`;
                        nextQBtn.style.display = 'block';
                    };
                    quizOptions.appendChild(el);
                });
                quizResult.textContent = '';
                nextQBtn.style.display = 'none';
            }

            // ---------- EVENT LISTENERS ----------
            flashcard.addEventListener('click', e => { if (!e.target.closest('#speakToggleBtn')) flipCard(); });
            speakBtn.addEventListener('click', e => { e.stopPropagation(); toggleSpeak(); if (autoSpeakEnabled) speakCurrent(); else window.speechSynthesis?.cancel(); });
            nextBtn.addEventListener('click', nextWord);
            prevBtn.addEventListener('click', prevWord);
            shuffleBtn.addEventListener('click', shuffleWords);
            autoPlayBtn.addEventListener('click', toggleAutoPlay);
            quizBtn.addEventListener('click', toggleQuizMode);
            nextQBtn.addEventListener('click', generateQuiz);
            familyBtns.forEach(b => b.addEventListener('click', () => switchFamily(b.dataset.family)));

            document.addEventListener('keydown', e => {
                if (isQuizMode) { if (e.key === 'Enter') { e.preventDefault(); generateQuiz(); } return; }
                switch(e.key) {
                    case 'ArrowRight': case ' ': e.preventDefault(); flipCard(); break;
                    case 'ArrowLeft': e.preventDefault(); prevWord(); break;
                    case 'ArrowUp': e.preventDefault(); nextWord(); break;
                    case 'Enter': e.preventDefault(); speakCurrent(); break;
                    case 's': case 'S': e.preventDefault(); shuffleWords(); break;
                    case 'a': case 'A': e.preventDefault(); toggleAutoPlay(); break;
                    case 'q': case 'Q': e.preventDefault(); toggleQuizMode(); break;
                }
            });

            let touchX = 0;
            flashcard.addEventListener('touchstart', e => touchX = e.touches[0].clientX, { passive: true });
            flashcard.addEventListener('touchend', e => {
                const delta = e.changedTouches[0].clientX - touchX;
                if (Math.abs(delta) > 40) delta > 0 ? prevWord() : flipCard();
            }, { passive: true });

            // ---------- INIT ----------
            if (window.speechSynthesis) { window.speechSynthesis.getVoices(); speechSynthesis.onvoiceschanged = () => {}; }
            // Default auto speak ON
            speakBtn.classList.remove('off');
            speakIcon.className = 'fas fa-volume-up';
            speakBtn.style.background = '#1e88e5';
            updateCard(); updateProgress(); updateNav(); updateStats();
        })();
    </script>
</body>
</html>
